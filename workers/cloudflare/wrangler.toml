name = "translator"
main = "translator.js"
compatibility_date = "2025-01-01"

# Production environment (default)
[vars]
ENVIRONMENT = "production"
AZURE_REGION = "eastus"

# Enable observability and logging
[observability]
enabled = true

[observability.logs]
enabled = true

# Production rate limiting bindings
[[unsafe.bindings]]
name = "TRANSLATION_RATE_LIMITER"
type = "ratelimit"
namespace_id = "1001"
simple = { limit = 100, period = 3600 }

[[unsafe.bindings]]
name = "AI_RATE_LIMITER"
type = "ratelimit"
namespace_id = "1002"
simple = { limit = 100, period = 3600 }

[[unsafe.bindings]]
name = "DAILY_TRANSLATION_LIMITER"
type = "ratelimit"
namespace_id = "1003"
simple = { limit = 1000, period = 86400 }

[[unsafe.bindings]]
name = "DAILY_AI_LIMITER"
type = "ratelimit"
namespace_id = "1004"
simple = { limit = 500, period = 86400 }

# D1 Database binding for production
[[d1_databases]]
binding = "DB"
database_name = "translator"
database_id = "f1a6d16b-cc72-48a0-bc33-8ec71f75b75c"

[limits]
cpu_ms = 50

# Development environment
[env.development]
name = "translator-dev"

[env.development.vars]
ENVIRONMENT = "development"
AZURE_REGION = "eastus"

# Development rate limiting bindings (higher limits for testing)
[[env.development.unsafe.bindings]]
name = "TRANSLATION_RATE_LIMITER"
type = "ratelimit"
namespace_id = "2001"
simple = { limit = 1000, period = 3600 }

[[env.development.unsafe.bindings]]
name = "AI_RATE_LIMITER"
type = "ratelimit"
namespace_id = "2002"
simple = { limit = 1000, period = 3600 }

[[env.development.unsafe.bindings]]
name = "DAILY_TRANSLATION_LIMITER"
type = "ratelimit"
namespace_id = "2003"
simple = { limit = 10000, period = 86400 }

[[env.development.unsafe.bindings]]
name = "DAILY_AI_LIMITER"
type = "ratelimit"
namespace_id = "2004"
simple = { limit = 5000, period = 86400 }

# D1 Database binding for development
[[env.development.d1_databases]]
binding = "DB"
database_name = "translator-dev"
database_id = "53323f1e-ce8a-4ba3-8732-5b62b088cdf2"

[env.development.limits]
cpu_ms = 100  # More generous for dev

[env.development.observability]
enabled = true
head_sampling_rate = 1.0  # Sample all requests in dev